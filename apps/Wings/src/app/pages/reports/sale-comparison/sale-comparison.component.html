<!-- Replace all currency pipes with number pipes -->
<!-- Example: {{ value | currency:'USD':'symbol':'1.2-2' }} becomes {{ value | number:'1.2-2' }} -->

<!--table starts-->
<section id="ng-tables">
  <div class="row text-left">
    <div class="col-12">
      <div class="content-header">Sale Report by Agents</div>
    </div>
  </div>

  <div class="card">
    <div class="card-content">
      <div class="card-body">
        <div class="mb-2">
          <form #frmFilter="ngForm">
            <div class="row no-pad">
              <div class="col-md-2">
                <label for="dtFrom">From Date:</label>
                <div class="input-group">
                  <input
                    class="form-control"
                    placeholder="yyyy-mm-dd"
                    name="dtFrom"
                    [(ngModel)]="Filter.FromDate"
                    ngbDatepicker
                    #dtFrom="ngbDatepicker"
                  />
                  <div class="input-group-append">
                    <button
                      type="button"
                      class="btn btn-primary"
                      (click)="dtFrom.toggle()"
                    >
                      <i class="fa fa-calendar"></i>
                    </button>
                  </div>
                </div>
              </div>
              <div class="col-md-2">
                <label for="dtTo">To Date:</label>
                <div class="input-group">
                  <input
                    class="form-control"
                    placeholder="yyyy-mm-dd"
                    name="dtTo"
                    [(ngModel)]="Filter.ToDate"
                    ngbDatepicker
                    #dtTo="ngbDatepicker"
                  />
                  <div class="input-group-append">
                    <button
                      type="button"
                      class="btn btn-primary"
                      (click)="dtTo.toggle()"
                    >
                      <i class="fa fa-calendar"></i>
                    </button>
                  </div>
                </div>
              </div>

              <div class="col-md-1">
                <div class="form-group">
                  <label>&nbsp;</label>
                  <button
                    type="submit"
                    class="btn btn-primary form-control"
                    (click)="FilterData()"
                    accesskey="f"
                  >
                    <i class="fa fa-search"></i>
                  </button>
                </div>
              </div>
              <div class="col-md-1">
                <div class="form-group">
                  <label>&nbsp;</label>
                  <button
                    type="submit"
                    class="btn btn-warning form-control"
                    (click)="PrintReport()"
                    accesskey="p"
                  >
                    <i class="fa fa-print"></i>
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div id="print-section">
          <!-- Loading indicator -->
          <div class="text-center py-4" *ngIf="!Data">
            <div class="spinner-border text-primary" role="status">
              <span class="sr-only">Loading...</span>
            </div>
            <p class="mt-2">Loading data...</p>
          </div>

          <!-- Cross-tab table -->
          <div class="table-responsive" *ngIf="Data && processedData && processedData.length > 0">
            <table class="table table-striped table-bordered">
              <thead class="thead-dark">
                <tr>
                  <th rowspan="2" class="align-middle">Agent Name</th>
                  <th rowspan="2" class="align-middle">Total Invoices</th>
                  <th *ngFor="let month of uniqueMonths" colspan="2" class="text-center">
                    {{ month.month_name }}
                  </th>
                  <th colspan="2" class="text-center bg-warning">Total</th>
                </tr>
                <tr>
                  <ng-container *ngFor="let month of uniqueMonths">
                    <th class="text-center">Sale</th>
                    <th class="text-center">Profit</th>
                  </ng-container>
                  <th class="text-center bg-warning">Total Sale</th>
                  <th class="text-center bg-warning">Total Profit</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let agent of processedData">
                  <td class="font-weight-bold">{{ agent.agent_name }}</td>
                  <td class="text-center">{{ agent.total_invoices | number }}</td>
                  <ng-container *ngFor="let month of uniqueMonths">
                    <td class="text-right">
                      {{ getMonthData(agent, month.month)?.net_amount | number:'1.2-2' || '0.00' }}
                    </td>
                    <td class="text-right">
                      {{ getMonthData(agent, month.month)?.profit | number:'1.2-2' || '0.00' }}
                    </td>
                  </ng-container>
                  <td class="text-right font-weight-bold bg-light">
                    {{ agent.total_sale | number:'1.2-2' }}
                  </td>
                  <td class="text-right font-weight-bold bg-light">
                    {{ agent.total_profit | number:'1.2-2' }}
                  </td>
                </tr>
              </tbody>
              <tfoot class="thead-dark">
                <tr>
                  <th>Grand Total</th>
                  <th class="text-center">{{ grandTotal.total_invoices | number }}</th>
                  <ng-container *ngFor="let month of uniqueMonths">
                    <th class="text-right">
                      {{ getGrandTotalForMonth(month.month, 'net_amount') | number:'1.2-2' }}
                    </th>
                    <th class="text-right">
                      {{ getGrandTotalForMonth(month.month, 'profit') | number:'1.2-2' }}
                    </th>
                  </ng-container>
                  <th class="text-right bg-warning">
                    {{ grandTotal.total_sale | number:'1.2-2' }}
                  </th>
                  <th class="text-right bg-warning">
                    {{ grandTotal.total_profit | number:'1.2-2' }}
                  </th>
                </tr>
              </tfoot>
            </table>
          </div>

          <!-- No data message -->
          <div class="text-center mt-4" *ngIf="Data && (!processedData || processedData.length === 0)">
            <div class="alert alert-info">
              <i class="fa fa-info-circle"></i>
              <strong>No Data Found</strong>
              <p class="mb-0 mt-2">No sales data available for the selected date range. Please try adjusting your filter criteria.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
