<VirtualHost *:8080>
    ServerName php74.localhost
    DocumentRoot "/Volumes/Work/Work-Angular/Work13/apps/ePOSPlus"

    # Main directory configuration
    <Directory "/Volumes/Work/Work-Angular/Work13/apps/ePOSPlus">
        AllowOverride All
        Require all granted
        Options Indexes FollowSymLinks
    </Directory>

    # APIs alias configuration
    Alias /posplus "/Volumes/Work/Work-Angular/Work13/apps/ePOSPlus/Apis"

    # APIs directory configuration
    <Directory "/Volumes/Work/Work-Angular/Work13/apps/ePOSPlus/Apis">
        AllowOverride All
        Require all granted
        Options -Indexes FollowSymLinks
        DirectoryIndex index.php

        # Enable rewrite engine for CodeIgniter
        RewriteEngine On
        RewriteBase /posplus/

        # CodeIgniter specific rules
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond $1 !^(index\.php|assets|install|update)
        RewriteRule ^(.*)$ index.php/$1 [NC,L,QSA]
    </Directory>

    # Security: Prevent access to system and application folders
    <Directory "/Volumes/Work/Work-Angular/Work13/apps/ePOSPlus/Apis/system">
        Require all denied
    </Directory>

    <Directory "/Volumes/Work/Work-Angular/Work13/apps/ePOSPlus/Apis/application">
        Require all denied
    </Directory>

    # Allow access to application assets if they exist
    <Directory "/Volumes/Work/Work-Angular/Work13/apps/ePOSPlus/Apis/assets">
        AllowOverride None
        Require all granted
    </Directory>

    # PHP Configuration
    <FilesMatch \.php$>
        SetHandler application/x-httpd-php74
    </FilesMatch>

    # Error and Access logs
    ErrorLog "/var/log/apache2/posplus_error.log"
    CustomLog "/var/log/apache2/posplus_access.log" combined
</VirtualHost>
