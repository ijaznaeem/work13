<div class="other-income-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="row align-items-center">
      <div class="col-md-6">
        <h2 class="page-title">
          <i class="fas fa-chart-line me-2 text-orange"></i>
          Other Income Report
        </h2>
        <p class="page-description text-muted">
          Manage and track other income entries with comprehensive reporting
        </p>
      </div>
      <div class="col-md-6 text-end">
        <div class="total-amount-display">
          <h4 class="text-orange mb-0">
            Total: {{ totalAmount | currency:'USD':'symbol':'1.2-2' }}
          </h4>
        </div>
      </div>
    </div>
  </div>

  <!-- Filter Section -->
  <div class="filter-card">
    <div class="card">
      <div class="card-header bg-orange text-white">
        <h5 class="card-title mb-0">
          <i class="fas fa-filter me-2"></i>
          Date Range Filter
        </h5>
      </div>
      <div class="card-body">
        <form [formGroup]="filterForm" class="row g-3">
          <div class="col-md-4">
            <label for="fromDate" class="form-label">
              <i class="fas fa-calendar-alt me-1"></i>
              From Date
            </label>
            <input
              type="date"
              id="fromDate"
              class="form-control"
              formControlName="fromDate"
              [class.is-invalid]="isFieldInvalid('fromDate', filterForm)">
            <div *ngIf="isFieldInvalid('fromDate', filterForm)" class="invalid-feedback">
              {{ getFieldError('fromDate', filterForm) }}
            </div>
          </div>
          
          <div class="col-md-4">
            <label for="toDate" class="form-label">
              <i class="fas fa-calendar-alt me-1"></i>
              To Date
            </label>
            <input
              type="date"
              id="toDate"
              class="form-control"
              formControlName="toDate"
              [class.is-invalid]="isFieldInvalid('toDate', filterForm)">
            <div *ngIf="isFieldInvalid('toDate', filterForm)" class="invalid-feedback">
              {{ getFieldError('toDate', filterForm) }}
            </div>
          </div>
          
          <div class="col-md-4 d-flex align-items-end">
            <button
              type="button"
              class="btn btn-orange"
              (click)="loadOtherIncomeData()"
              [disabled]="!filterForm.valid || isLoading">
              <i class="fas fa-search me-2"></i>
              {{ isLoading ? 'Loading...' : 'Show Report' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <div class="row">
      <div class="col-12">
        <div class="btn-group" role="group">
          <button
            type="button"
            class="btn btn-success"
            (click)="openAddIncomeModal()">
            <i class="fas fa-plus me-2"></i>
            Add Income
          </button>
          
          <button
            type="button"
            class="btn btn-primary"
            (click)="openEditIncomeModal()"
            [disabled]="!selectedIncomeEntry">
            <i class="fas fa-edit me-2"></i>
            Edit
          </button>
          
          <button
            type="button"
            class="btn btn-danger"
            (click)="openDeleteConfirmModal()"
            [disabled]="!selectedIncomeEntry">
            <i class="fas fa-trash me-2"></i>
            Delete
          </button>
          
          <button
            type="button"
            class="btn btn-info"
            (click)="printReport()"
            [disabled]="!filterForm.valid">
            <i class="fas fa-print me-2"></i>
            Print Report
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Data Grid Section -->
  <div class="data-grid-card">
    <div class="card">
      <div class="card-header bg-light">
        <h5 class="card-title mb-0">
          <i class="fas fa-table me-2"></i>
          Other Income Entries
        </h5>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <ng2-smart-table
            [settings]="tableSettings"
            [source]="otherIncomeData"
            (rowSelect)="onRowSelect($event)"
            class="income-table">
          </ng2-smart-table>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner-border text-orange" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
</div>

<!-- Add/Edit Income Modal -->
<ng-template #addIncomeModal let-modal>
  <div class="modal-header bg-orange text-white">
    <h4 class="modal-title">
      <i class="fas fa-plus-circle me-2"></i>
      {{ isEditMode ? 'Edit Income Entry' : 'Add Income Entry' }}
    </h4>
    <button type="button" class="btn-close btn-close-white" (click)="modal.dismiss()"></button>
  </div>
  
  <div class="modal-body">
    <form [formGroup]="incomeForm">
      <div class="row g-3">
        <div class="col-md-6">
          <label for="date" class="form-label">
            <i class="fas fa-calendar me-1"></i>
            Date *
          </label>
          <input
            type="date"
            id="date"
            class="form-control"
            formControlName="date"
            [class.is-invalid]="isFieldInvalid('date')">
          <div *ngIf="isFieldInvalid('date')" class="invalid-feedback">
            {{ getFieldError('date') }}
          </div>
        </div>
        
        <div class="col-md-6">
          <label for="amount" class="form-label">
            <i class="fas fa-dollar-sign me-1"></i>
            Amount *
          </label>
          <input
            type="number"
            id="amount"
            class="form-control"
            formControlName="amount"
            step="0.01"
            min="0"
            [class.is-invalid]="isFieldInvalid('amount')">
          <div *ngIf="isFieldInvalid('amount')" class="invalid-feedback">
            {{ getFieldError('amount') }}
          </div>
        </div>
        
        <div class="col-12">
          <label for="description" class="form-label">
            <i class="fas fa-file-alt me-1"></i>
            Description *
          </label>
          <textarea
            id="description"
            class="form-control"
            formControlName="description"
            rows="3"
            maxlength="500"
            [class.is-invalid]="isFieldInvalid('description')"></textarea>
          <div *ngIf="isFieldInvalid('description')" class="invalid-feedback">
            {{ getFieldError('description') }}
          </div>
        </div>
        
        <div class="col-md-6">
          <label for="reference" class="form-label">
            <i class="fas fa-hashtag me-1"></i>
            Reference
          </label>
          <input
            type="text"
            id="reference"
            class="form-control"
            formControlName="reference"
            maxlength="100"
            [class.is-invalid]="isFieldInvalid('reference')">
          <div *ngIf="isFieldInvalid('reference')" class="invalid-feedback">
            {{ getFieldError('reference') }}
          </div>
        </div>
        
        <div class="col-md-6">
          <label for="status" class="form-label">
            <i class="fas fa-flag me-1"></i>
            Status
          </label>
          <select
            id="status"
            class="form-select"
            formControlName="status">
            <option value="0">Draft</option>
            <option value="1">Posted</option>
          </select>
        </div>
        
        <div class="col-12">
          <label for="remarks" class="form-label">
            <i class="fas fa-comment me-1"></i>
            Remarks
          </label>
          <textarea
            id="remarks"
            class="form-control"
            formControlName="remarks"
            rows="2"
            maxlength="1000"></textarea>
        </div>
      </div>
    </form>
  </div>
  
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">
      <i class="fas fa-times me-2"></i>
      Cancel
    </button>
    <button
      type="button"
      class="btn btn-orange"
      (click)="saveIncomeEntry()"
      [disabled]="!incomeForm.valid || isLoading">
      <i class="fas fa-save me-2"></i>
      {{ isLoading ? 'Saving...' : (isEditMode ? 'Update' : 'Save') }}
    </button>
  </div>
</ng-template>

<!-- Edit Income Modal (same as add modal) -->
<ng-template #editIncomeModal let-modal>
  <div class="modal-header bg-primary text-white">
    <h4 class="modal-title">
      <i class="fas fa-edit me-2"></i>
      Edit Income Entry
    </h4>
    <button type="button" class="btn-close btn-close-white" (click)="modal.dismiss()"></button>
  </div>
  
  <div class="modal-body">
    <form [formGroup]="incomeForm">
      <div class="row g-3">
        <div class="col-md-6">
          <label for="editDate" class="form-label">
            <i class="fas fa-calendar me-1"></i>
            Date *
          </label>
          <input
            type="date"
            id="editDate"
            class="form-control"
            formControlName="date"
            [class.is-invalid]="isFieldInvalid('date')">
          <div *ngIf="isFieldInvalid('date')" class="invalid-feedback">
            {{ getFieldError('date') }}
          </div>
        </div>
        
        <div class="col-md-6">
          <label for="editAmount" class="form-label">
            <i class="fas fa-dollar-sign me-1"></i>
            Amount *
          </label>
          <input
            type="number"
            id="editAmount"
            class="form-control"
            formControlName="amount"
            step="0.01"
            min="0"
            [class.is-invalid]="isFieldInvalid('amount')">
          <div *ngIf="isFieldInvalid('amount')" class="invalid-feedback">
            {{ getFieldError('amount') }}
          </div>
        </div>
        
        <div class="col-12">
          <label for="editDescription" class="form-label">
            <i class="fas fa-file-alt me-1"></i>
            Description *
          </label>
          <textarea
            id="editDescription"
            class="form-control"
            formControlName="description"
            rows="3"
            maxlength="500"
            [class.is-invalid]="isFieldInvalid('description')"></textarea>
          <div *ngIf="isFieldInvalid('description')" class="invalid-feedback">
            {{ getFieldError('description') }}
          </div>
        </div>
        
        <div class="col-md-6">
          <label for="editReference" class="form-label">
            <i class="fas fa-hashtag me-1"></i>
            Reference
          </label>
          <input
            type="text"
            id="editReference"
            class="form-control"
            formControlName="reference"
            maxlength="100"
            [class.is-invalid]="isFieldInvalid('reference')">
          <div *ngIf="isFieldInvalid('reference')" class="invalid-feedback">
            {{ getFieldError('reference') }}
          </div>
        </div>
        
        <div class="col-md-6">
          <label for="editStatus" class="form-label">
            <i class="fas fa-flag me-1"></i>
            Status
          </label>
          <select
            id="editStatus"
            class="form-select"
            formControlName="status">
            <option value="0">Draft</option>
            <option value="1">Posted</option>
          </select>
        </div>
        
        <div class="col-12">
          <label for="editRemarks" class="form-label">
            <i class="fas fa-comment me-1"></i>
            Remarks
          </label>
          <textarea
            id="editRemarks"
            class="form-control"
            formControlName="remarks"
            rows="2"
            maxlength="1000"></textarea>
        </div>
      </div>
    </form>
  </div>
  
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">
      <i class="fas fa-times me-2"></i>
      Cancel
    </button>
    <button
      type="button"
      class="btn btn-primary"
      (click)="saveIncomeEntry()"
      [disabled]="!incomeForm.valid || isLoading">
      <i class="fas fa-save me-2"></i>
      {{ isLoading ? 'Updating...' : 'Update' }}
    </button>
  </div>
</ng-template>

<!-- Delete Confirmation Modal -->
<ng-template #confirmDeleteModal let-modal>
  <div class="modal-header bg-danger text-white">
    <h4 class="modal-title">
      <i class="fas fa-exclamation-triangle me-2"></i>
      Confirm Deletion
    </h4>
    <button type="button" class="btn-close btn-close-white" (click)="modal.dismiss()"></button>
  </div>
  
  <div class="modal-body">
    <div class="text-center">
      <i class="fas fa-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
      <h5 class="mt-3">Are you sure you want to delete this income entry?</h5>
      <p class="text-muted">This action cannot be undone.</p>
      
      <div *ngIf="selectedIncomeEntry" class="alert alert-info">
        <strong>Entry Details:</strong><br>
        Date: {{ selectedIncomeEntry.Date | date:'shortDate' }}<br>
        Description: {{ selectedIncomeEntry.Description }}<br>
        Amount: {{ selectedIncomeEntry.Amount | currency:'USD':'symbol':'1.2-2' }}
      </div>
    </div>
  </div>
  
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">
      <i class="fas fa-times me-2"></i>
      Cancel
    </button>
    <button
      type="button"
      class="btn btn-danger"
      (click)="confirmDelete()"
      [disabled]="isLoading">
      <i class="fas fa-trash me-2"></i>
      {{ isLoading ? 'Deleting...' : 'Delete' }}
    </button>
  </div>
</ng-template>