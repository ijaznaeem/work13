<!--Enhanced Orders List with Customer Grouping-->
<section id="ng-tables">
  <div class="row text-left mb-3">
    <div class="col-md-6">
      <div class="content-header">
        <i class="fa fa-shopping-cart"></i> Orders Management
      </div>
      <small class="text-muted">
        Manage customer orders with detailed product information
      </small>
    </div>
    <div class="col-md-6 text-right">
      <div class="btn-group mr-2">
        <button
          class="btn btn-outline-primary"
          [class.active]="viewMode === 'card'"
          (click)="viewMode = 'card'">
          <i class="fa fa-th-large"></i> Card View
        </button>
        <button
          class="btn btn-outline-primary"
          [class.active]="viewMode === 'table'"
          (click)="viewMode = 'table'">
          <i class="fa fa-table"></i> Table View
        </button>
      </div>
      <button class="btn btn-success" (click)="AddNew()">
        <i class="fa fa-plus"></i> Add New Order
      </button>
    </div>
  </div>

  <!-- Filters Card -->
  <div class="card ">
    <div class="card-header bg-light">
      <h6 class="mb-0">
        <i class="fa fa-filter"></i> Filters & Search
      </h6>
    </div>
    <div class="card-body">
      <ft-crud-form
        [form]="FilterForm"
        [formdata]="Filter"
        [CrudButtons]="false"
      >
      </ft-crud-form>
    </div>
  </div>

  <!-- Summary Statistics -->
  <div class="row ">
    <div class="col-md-3">
      <div class="card bg-primary text-white">
        <div class="card-body text-center">
          <h4 class="mb-1">{{ data.length }}</h4>
          <p class="mb-0">Total Orders</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-success text-white">
        <div class="card-body text-center">
          <!-- <h4 class="mb-1">{{ uniqueCustomerCount }}</h4>
          <p class="mb-0">Unique Customers</p> -->
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-info text-white">
        <div class="card-body text-center">
          <h4 class="mb-1">{{ orderDetails.length }}</h4>
          <p class="mb-0">Total Items</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-warning text-white">
        <div class="card-body text-center">
          <h4 class="mb-1">{{ totalOrdersAmount | currency:'EUR':'symbol':'1.2-2' }}</h4>
          <p class="mb-0">Total Value</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Flat Orders Card View -->
  <div *ngIf="viewMode === 'card'">
    <div *ngIf="data.length === 0" class="alert alert-info text-center">
      <i class="fa fa-info-circle fa-2x mb-2"></i>
      <h5>No Orders Found</h5>
      <p>No orders match your current filter criteria. Try adjusting the date range or search terms.</p>
    </div>

    <div *ngFor="let order of data; let orderIndex = index" class="card mb-4 shadow-sm">
      <!-- Order Header -->
      <div class="card-header bg-gradient-primary text-white">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h5 class="mb-1">
              <i class="fa fa-user"></i> {{ order.CustomerName }}
            </h5>
            <div class="row">
              <div class="col-md-6" *ngIf="order.Address">
                <small><i class="fa fa-map-marker"></i> {{ order.Address }}, {{ order.City }}</small>
              </div>
              <div class="col-md-6" *ngIf="order.PhoneNo1">
                <small><i class="fa fa-phone"></i> {{ order.PhoneNo1 }}<span *ngIf="order.PhoneNo2">, {{ order.PhoneNo2 }}</span></small>
              </div>
            </div>
          </div>
          <div class="col-md-4 text-right">
            <h6 class="mb-1">Order #{{ order.OrderID }}</h6>
            <h5 class="mb-0">{{ order.Amount | currency:'EUR':'symbol':'1.2-2' }}</h5>
          </div>
        </div>
      </div>

      <!-- Order Details -->
      <div class="card-body p-0">
        <div class="border-bottom bg-light p-3">
          <div class="row align-items-center">
            <div class="col-md-6">
              <h6 class="mb-1">
                <span class="badge badge-primary mr-2">Order #{{ order.OrderID }}</span>
                <span class="text-muted">{{ order.Date | date:'mediumDate' }}</span>
              </h6>
              <span class="badge"
                    [class.badge-success]="order.IsPosted == '1'"
                    [class.badge-warning]="order.IsPosted == '0'">
                {{ order.IsPosted == '1' ? 'Posted' : 'Pending' }}
              </span>
            </div>
            <div class="col-md-6 text-right">
              <h6 class="mb-1 text-success">{{ order.Amount | currency:'EUR':'symbol':'1.2-2' }}</h6>
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-primary btn-sm"
                        (click)="AddNew(order.OrderID)"
                        [disabled]="order.IsPosted == '1'"
                        title="Edit Order">
                  <i class="fa fa-edit"></i>
                </button>
                <button class="btn btn-outline-success btn-sm"
                        (click)="Clicked({action: 'print', data: order})"
                        title="Print Order">
                  <i class="fa fa-print"></i>
                </button>
                <button class="btn btn-outline-success btn-sm"
                        (click)="CreateInvoice(order.OrderID)"
                        [disabled]="order.IsPosted == '1'"
                        title="Generate Invoice">
                  <i class="fa fa-file-invoice"></i>
                </button>
                <button class="btn btn-outline-danger btn-sm"
                        (click)="Clicked({action: 'delete', data: order})"
                        [disabled]="order.IsPosted == '1'"
                        title="Delete Order">
                  <i class="fa fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="row mt-2" *ngIf="order.Notes">
            <div class="col-12">
              <small class="text-muted">
                <i class="fa fa-sticky-note"></i> {{ order.Notes }}
              </small>
            </div>
          </div>
        </div>

        <!-- Order Items -->
        <div class="p-3">
          <div *ngIf="order.details && order.details.length > 0">
            <div class="row">
              <div *ngFor="let item of order.details; let itemIndex = index"
                   class="col-md-6 col-lg-4 mb-3">
                <div class="card h-100 border-0 shadow-sm">
                  <div class="row no-gutters h-100">
                    <div class="col-4">
                      <img [src]="item.Image"
                           [alt]="item.ProductName"
                           class="card-img h-100"
                           style="object-fit: cover; max-height: 120px;">
                    </div>
                    <div class="col-8">
                      <div class="card-body p-2">
                        <h6 class="card-title text-truncate" [title]="item.ProductName">
                          {{ item.ProductName }}
                        </h6>
                        <div class="mb-2">
                          <span class="badge badge-info mr-1" *ngIf="item.Color && item.Color !== 'N/A'">
                            <i class="fa fa-palette"></i> {{ item.Color }}
                          </span>
                          <span class="badge badge-secondary mr-1" *ngIf="item.Size && item.Size !== 'N/A'">
                            <i class="fa fa-expand-arrows-alt"></i> {{ item.Size }}
                          </span>
                        </div>
                        <div class="d-flex justify-content-between align-items-end">
                          <div>
                            <small class="text-muted">Qty: {{ item.Qty }}</small><br>
                            <small class="text-muted">@ {{ item.SPrice | currency:'EUR':'symbol':'1.2-2' }}</small>
                          </div>
                          <h6 class="mb-0 text-success">
                            {{ item.Amount | currency:'EUR':'symbol':'1.2-2' }}
                          </h6>
                        </div>
                        <div *ngIf="item.Notes && item.Notes.trim() !== ''" class="mt-1">
                          <small class="text-muted">
                            <i class="fa fa-sticky-note"></i> {{ item.Notes }}
                          </small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="!order.details || order.details.length === 0"
               class="alert alert-warning">
            <i class="fa fa-exclamation-triangle"></i>
            No items found for this order.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Traditional Table View -->
  <div *ngIf="viewMode === 'table'" class="card">
    <div class="card-header">
      <h6 class="mb-0">
        <i class="fa fa-table"></i> Orders Table View
      </h6>
    </div>
    <div class="card-body">
      <ft-dynamic-table
        #rptTable
        [Settings]="Settings"
        [Data]="data"
        [Search]="Filter.Search"
        (ClickAction)="Clicked($event)"
      ></ft-dynamic-table>
    </div>
  </div>
</section>
