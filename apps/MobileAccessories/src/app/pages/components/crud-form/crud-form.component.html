<form
  class="needs-validation"
  (ngSubmit)="userForm.form.valid && SaveData()"
  #userForm="ngForm"
>
  <div class="row no-pad">
    <div [class]="'px-* col-md-' + col.size" *ngFor="let col of form.columns">
      <div class="form-group">
        <label for="col.fldName">
          {{ col.control === 'button' ? '&nbsp;' : col.label }}</label
        >
        <input
          *ngIf="col.control === 'input'"
          [type]="col.type"
          class="form-control validation-field"
          [required]="col.required"
          [readonly]="col.readonly"
          [(ngModel)]="formdata[col.fldName]"
          [name]="col.fldName"
          [value]="col.value"
          [ngClass]="{
            'is-invalid':
              userForm.submitted && userForm.controls[col.fldName].invalid,
            'is-valid':
              userForm.submitted && !userForm.controls[col.fldName].invalid
          }"
          (change)="Changed(col.fldName, $event.target.value)"
          placeholder=""
        />

        <!-- <ngb-timepicker
              *ngIf="col.control === 'input' && col.type === 'time'"
                [(ngModel)]="formdata[col.fldName]"
                [meridian]="'true'"
                [name]="col.fldName"
                (change)="Changed(col.fldName, $event.target.value)"
              >
              </ngb-timepicker> -->

        <ejs-autocomplete
          [name]="col.fldName"
          [(ngModel)]="formdata[col.fldName]"
          *ngIf="col.control === 'select' && col.type === 'autocomplete'"
          [dataSource]="col.listData"
          [fields]="{ value: col.displayFld }"
          (change)="Changed(col.fldName, $event.value)"
          [required]="col.required"
        ></ejs-autocomplete>

        <ejs-combobox
          [name]="col.fldName"
          [(ngModel)]="formdata[col.fldName]"
          *ngIf="col.control === 'select' && col.type === 'lookup'"
          [dataSource]="col.listData"
          [fields]="{ text: col.displayFld, value: col.valueFld }"
          [placeholder]=""
          (change)="Changed(col.fldName, $event.value)"
          [required]="col.required"
        ></ejs-combobox>
        <div *ngIf="col.control === 'select' && col.type === 'ngselect'">
          <h1>X</h1>
          <ng-select
            #ngSelect
            [name]="col.fldName"
            class="custom"
            [items]="col.listData"
            [bindLabel]="col.displayFld"
            [bindValue]="col.valueFld"
            [(ngModel)]="formdata[col.fldName]"
            [required]="col.required"
            [disabled]="col.disabled"
            selectOnTab="true"
            [ngClass]="{
              'is-invalid':
                userForm.submitted && userForm.controls[col.fldName].invalid,
              'is-valid':
                userForm.submitted && !userForm.controls[col.fldName].invalid
            }"
            typeToSearchText="Please enter {{
              minLengthTerm
            }} or more characters"
            [placeholder]="col.placeHolder"
            (change)="Changed(col.fldName, $event)"
            [searchable]="true"
            [clearable]="true"
          >
          </ng-select>
        </div>
        <select
          [name]="col.fldName"
          [(ngModel)]="formdata[col.fldName]"
          class="form-control validation-field"
          *ngIf="col.control === 'select' && col.type === 'list'"
          (change)="Changed(col.fldName, $event.target.value)"
          [ngClass]="{
            'is-invalid':
              userForm.submitted && userForm.controls[col.fldName].invalid,
            'is-valid':
              userForm.submitted && !userForm.controls[col.fldName].invalid
          }"
          [required]="col.required"
        >
          <option [value]="" *ngIf="col.placeHolder">
            {{ col.placeHolder }}
          </option>
          <option [value]="d[col.valueFld]" *ngFor="let d of col.listData">
            {{ d[col.valueFld] }} - {{ d[col.displayFld] }}
          </option>
        </select>

        <span *ngIf="col.control === 'file'">
          <ngx-dropzone (change)="onSelect($event)" [expandable]="true">
            <ngx-dropzone-label>{{ col.label }}</ngx-dropzone-label>
            <ngx-dropzone-image-preview
              ngProjectAs="ngx-dropzone-preview"
              *ngIf="files"
              [file]="files"
              [removable]="true"
              (removed)="onRemove(files)"
            >
              <ngx-dropzone-label
                >{{ files.name }} ({{ files.type }})</ngx-dropzone-label
              >
            </ngx-dropzone-image-preview>
          </ngx-dropzone>
          <input
            type="hidden"
            [(ngModel)]="formdata[col.fldName]"
            [name]="col.fldName"
            placeholder=""
          />
        </span>

        <textarea
          *ngIf="col.control === 'textarea'"
          class="form-control validation-field"
          [required]="col.required"
          [(ngModel)]="formdata[col.fldName]"
          [name]="col.fldName"
          placeholder=""
          (change)="Changed(col.fldName, $event.target.value)"
        ></textarea>

        <button
          *ngIf="col.control === 'button'"
          [type]="col.type"
          class="form-control btn btn-{{ col.cssClass }}"
          (click)="col.OnClick(formdata)"
        >
          <i *ngIf="col.icon" class="fa fa-{{ col.icon }}"></i>

          {{ col.label }}
        </button>
      </div>
    </div>
  </div>
  <div class="row no-pad" *ngIf="CrudButtons">
    <div class="col-md-6 col-sm-4"></div>
    <div class="col-md-3 col-sm-4">
      <button type="submit" class="btn btn-success btn-block">
        <!-- [disabled]="!userForm.form.valid" -->
        {{ submitbutton }}
      </button>
    </div>

    <div class="col-md-3 col-sm-4" *ngIf="iscancel">
      <button
        type="button"
        class="btn btn-warning btn-block"
        (click)="closeModal()"
      >
        Cancel
      </button>
    </div>
  </div>
</form>
