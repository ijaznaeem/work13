<!--Login Page Starts-->
<section id="login">
  <div class="row auth-height full-height-vh m-0">
    <div class="col-12 d-flex align-items-center justify-content-center">
      <div class="card overflow-hidden">
        <div class="card-content">
          <div class="card-body auth-img">
            <!-- Dashboard Header -->
            <div class="row mb-3">
              <div class="col-lg-8 col-12">
                <h2 class="page-title">
                  <i class="ft-pie-chart mr-2"></i>
                  Accounting Dashboard
                  <small class="text-muted ml-2">{{ getDashboardStatus() }}</small>
                </h2>
                
                <!-- Status Badge -->
                <div class="mt-2">
                  <span class="badge badge-pill" 
                        [ngClass]="{
                          'badge-primary': isLoading,
                          'badge-success': !isLoading && hasAnyData(),
                          'badge-warning': !isLoading && !hasAnyData()
                        }">
                    <i class="ft-clock mr-1" *ngIf="isLoading"></i>
                    <i class="ft-check-circle mr-1" *ngIf="!isLoading && hasAnyData()"></i>
                    <i class="ft-alert-triangle mr-1" *ngIf="!isLoading && !hasAnyData()"></i>
                    {{ getPeriodText() }}
                  </span>
                  
                  <span class="badge badge-outline-secondary ml-2" *ngIf="!isLoading">
                    Last Updated: {{ lastUpdated | date:'MMM dd, HH:mm' }}
                  </span>
                </div>
              </div>
              <div class="col-lg-4 col-12 text-right">
                <div class="btn-group" role="group">
                  <button
                    type="button"
                    class="btn btn-sm"
                    [class.btn-primary]="selectedPeriod === 'current'"
                    [class.btn-outline-primary]="selectedPeriod !== 'current'"
                    (click)="changePeriod('current')"
                  >
                    Current Month
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm"
                    [class.btn-primary]="selectedPeriod === 'last'"
                    [class.btn-outline-primary]="selectedPeriod !== 'last'"
                    (click)="changePeriod('last')"
                  >
                    Last Month
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm"
                    [class.btn-primary]="selectedPeriod === 'year'"
                    [class.btn-outline-primary]="selectedPeriod !== 'year'"
                    (click)="changePeriod('year')"
                  >
                    Year to Date
                  </button>
                </div>
              </div>
            </div>

            <!-- Loading Indicator -->
            <div class="row mb-3" *ngIf="isLoading">
              <div class="col-12">
                <div class="alert alert-info d-flex align-items-center">
                  <div
                    class="spinner-border spinner-border-sm mr-2"
                    role="status"
                  >
                    <span class="sr-only">Loading...</span>
                  </div>
                  Fetching real-time financial data from accounting system...
                </div>
              </div>
            </div>

            <!-- Error State -->
            <div class="row mb-3" *ngIf="!isLoading && summaryCards.length === 0">
              <div class="col-12">
                <div class="alert alert-warning d-flex align-items-center">
                  <i class="ft-alert-triangle mr-2"></i>
                  <div>
                    <strong>No Data Available</strong><br>
                    Unable to load financial data. Please check your connection or contact support.
                    <button class="btn btn-sm btn-outline-warning ml-2" (click)="refreshDashboard()">
                      Try Again
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Summary Cards Row -->
            <div class="row mb-4" *ngIf="!isLoading">
              <div
                class="col-xl-3 col-md-6 col-12"
                *ngFor="let card of summaryCards"
              >
                <div class="card border-0 shadow-sm">
                  <div class="card-body p-3">
                    <div
                      class="d-flex justify-content-between align-items-center"
                    >
                      <div>
                        <h6 class="card-title text-muted mb-1">
                          {{ card.title }}
                        </h6>
                        <h3 class="mb-0 font-weight-bold" [ngClass]="'text-' + card.color">
                          {{ card.value }}
                        </h3>
                        <small class="text-{{ card.color }}" *ngIf="card.change !== 'N/A'">
                          <i
                            class="ft-trending-up"
                            *ngIf="card.trend === 'up'"
                          ></i>
                          <i
                            class="ft-trending-down"
                            *ngIf="card.trend === 'down'"
                          ></i>
                          {{ card.change }}
                          <span *ngIf="selectedPeriod !== 'year'">vs last period</span>
                          <span *ngIf="selectedPeriod === 'year'">YTD</span>
                        </small>
                        <small class="text-muted" *ngIf="card.change === 'N/A'">
                          Data unavailable
                        </small>
                      </div>
                      <div class="card-icon">
                        <i
                          class="{{ card.icon }} text-{{ card.color }}"
                          style="font-size: 2rem"
                        ></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Loading Cards Row -->
            <div class="row mb-4" *ngIf="isLoading">
              <div class="col-xl-3 col-md-6 col-12" *ngFor="let i of [1,2,3,4]">
                <div class="card border-0 shadow-sm">
                  <div class="card-body p-3">
                    <div class="d-flex justify-content-between align-items-center">
                      <div class="w-75">
                        <div class="bg-light rounded" style="height: 20px; margin-bottom: 8px;"></div>
                        <div class="bg-light rounded" style="height: 32px; margin-bottom: 8px;"></div>
                        <div class="bg-light rounded" style="height: 16px; width: 60%;"></div>
                      </div>
                      <div class="card-icon">
                        <div class="bg-light rounded-circle" style="width: 32px; height: 32px;"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Quick Actions Row -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card border-0 shadow-sm">
                  <div class="card-header bg-white border-bottom-0">
                    <h5 class="card-title mb-0">
                      <i class="ft-zap mr-2"></i>Quick Actions
                    </h5>
                  </div>
                  <div class="card-body p-3">
                    <div class="row">
                      <div
                        class="col-lg-3 col-md-6 col-12 mb-2"
                        *ngFor="let action of quickActions"
                      >
                        <button
                          class="btn btn-{{
                            action.color
                          }} btn-block d-flex align-items-center justify-content-start"
                          [routerLink]="action.route"
                        >
                          <i class="{{ action.icon }} mr-2"></i>
                          {{ action.title }}
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Charts and Data Row -->
            <div class="row mb-4">
              <!-- Monthly Performance Chart -->
              <div class="col-lg-8 col-12">
                <div class="card border-0 shadow-sm">
                  <div class="card-header bg-white border-bottom-0">
                    <div
                      class="d-flex justify-content-between align-items-center"
                    >
                      <h5 class="card-title mb-0">
                        <i class="ft-bar-chart-2 mr-2"></i>Monthly Performance
                        Chart
                      </h5>
                      <div>
                        <button
                          class="btn btn-outline-secondary btn-sm mr-2"
                          (click)="refreshDashboard()"
                        >
                          <i class="ft-refresh-cw"></i> Refresh
                        </button>
                        <button
                          class="btn btn-outline-primary btn-sm"
                          (click)="exportData()"
                        >
                          <i class="ft-download"></i> Export
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="card-body text-center">
                    <!-- Loading State -->
                    <div *ngIf="isLoading" class="d-flex justify-content-center align-items-center" style="height: 300px;">
                      <div class="spinner-border text-primary" role="status">
                        <span class="sr-only">Loading chart data...</span>
                      </div>
                    </div>
                    
                    <!-- Chart Display -->
                    <div *ngIf="!isLoading && chartData.length > 0">
                      <ngx-charts-line-chart
                        [view]="chartOptions.view"
                        [scheme]="chartOptions.colorScheme"
                        [results]="chartData"
                        [gradient]="chartOptions.gradient"
                        [xAxis]="chartOptions.showXAxis"
                        [yAxis]="chartOptions.showYAxis"
                        [legend]="chartOptions.showLegend"
                        [showXAxisLabel]="chartOptions.showXAxisLabel"
                        [showYAxisLabel]="chartOptions.showYAxisLabel"
                        [xAxisLabel]="chartOptions.xAxisLabel"
                        [yAxisLabel]="chartOptions.yAxisLabel"
                        [autoScale]="true"
                        [animations]="true"
                        (select)="onChartSelect($event)"
                        (activate)="onChartActivate($event)"
                        (deactivate)="onChartDeactivate($event)"
                      >
                      </ngx-charts-line-chart>
                    </div>

                    <!-- No Data State -->
                    <div *ngIf="!isLoading && chartData.length === 0" class="d-flex flex-column justify-content-center align-items-center" style="height: 300px;">
                      <i class="ft-bar-chart-2 text-muted mb-3" style="font-size: 3rem;"></i>
                      <h5 class="text-muted">No Chart Data Available</h5>
                      <p class="text-muted">Financial data will appear here when available.</p>
                    </div>
                  </div>
                  <div class="card-footer bg-white border-top-0">
                    <div class="table-responsive">
                      <table class="table table-sm table-hover mb-0">
                        <thead class="bg-light">
                          <tr>
                            <th>Month</th>
                            <th>Revenue</th>
                            <th>Expenses</th>
                            <th>Profit</th>
                            <th>Margin</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let data of monthlyData">
                            <td class="font-weight-medium">{{ data.month }}</td>
                            <td class="text-success">
                              {{ formatCurrency(data.revenue) }}
                            </td>
                            <td class="text-danger">
                              {{ formatCurrency(data.expenses) }}
                            </td>
                            <td class="text-info font-weight-bold">
                              {{ formatCurrency(data.profit) }}
                            </td>
                            <td>
                              <span class="badge badge-light">
                                {{
                                  ((data.profit / data.revenue) * 100).toFixed(
                                    1
                                  )
                                }}%
                              </span>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Account Balances and Expense Categories -->
              <div class="col-lg-4 col-12">
                <!-- Account Balances -->
                <div class="card border-0 shadow-sm mb-3">
                  <div class="card-header bg-white border-bottom-0">
                    <h5 class="card-title mb-0">
                      <i class="ft-credit-card mr-2"></i>Account Balances
                    </h5>
                  </div>
                  <div class="card-body p-2">
                    <div class="list-group list-group-flush">
                      <div
                        class="list-group-item border-0 px-2 py-2"
                        *ngFor="let account of accountBalances"
                      >
                        <div
                          class="d-flex justify-content-between align-items-center"
                        >
                          <div class="flex-grow-1">
                            <div class="text-truncate font-weight-medium">{{ account.name }}</div>
                            <small class="text-muted">{{ account.type | titlecase }}</small>
                          </div>
                          <span
                            class="font-weight-bold ml-2"
                            [ngClass]="getBalanceClass(account.balance)"
                          >
                            {{ formatCurrency(account.balance) }}
                          </span>
                        </div>
                      </div>
                      
                      <!-- No Data State -->
                      <div *ngIf="!isLoading && accountBalances.length === 0" class="text-center py-4">
                        <i class="ft-credit-card text-muted mb-2" style="font-size: 2rem;"></i>
                        <div class="text-muted">No account data available</div>
                        <small class="text-muted">Account balances will appear here</small>
                      </div>
                      
                      <!-- Loading State -->
                      <div *ngIf="isLoading" class="text-center py-4">
                        <div class="spinner-border spinner-border-sm text-primary" role="status">
                          <span class="sr-only">Loading accounts...</span>
                        </div>
                        <div class="text-muted mt-2">Loading account balances...</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Expense Categories Pie Chart -->
                <div class="card border-0 shadow-sm">
                  <div class="card-header bg-white border-bottom-0">
                    <h5 class="card-title mb-0">
                      <i class="ft-pie-chart mr-2"></i>Expense Breakdown
                    </h5>
                  </div>
                  <div class="card-body text-center">
                    <!-- Loading State -->
                    <div *ngIf="isLoading" class="d-flex justify-content-center align-items-center" style="height: 250px;">
                      <div class="spinner-border text-primary" role="status">
                        <span class="sr-only">Loading expense data...</span>
                      </div>
                    </div>
                    
                    <!-- Pie Chart -->
                    <div *ngIf="!isLoading && expenseCategories.length > 0">
                      <ngx-charts-pie-chart
                        [view]="pieChartOptions.view"
                        [scheme]="pieChartOptions.colorScheme"
                        [results]="expenseCategories"
                        [gradient]="pieChartOptions.gradient"
                        [legend]="pieChartOptions.showLegend"
                        [labels]="pieChartOptions.showLabels"
                        [doughnut]="pieChartOptions.isDoughnut"
                        [animations]="true"
                        [tooltipDisabled]="false"
                        (select)="onChartSelect($event)"
                        (activate)="onChartActivate($event)"
                        (deactivate)="onChartDeactivate($event)"
                      >
                      </ngx-charts-pie-chart>
                    </div>

                    <!-- No Data State -->
                    <div *ngIf="!isLoading && expenseCategories.length === 0" class="d-flex flex-column justify-content-center align-items-center" style="height: 250px;">
                      <i class="ft-pie-chart text-muted mb-3" style="font-size: 3rem;"></i>
                      <h6 class="text-muted">No Expense Data</h6>
                      <p class="text-muted small">Expense breakdown will appear here</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Recent Transactions -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card border-0 shadow-sm">
                  <div class="card-header bg-white border-bottom-0">
                    <div
                      class="d-flex justify-content-between align-items-center"
                    >
                      <h5 class="card-title mb-0">
                        <i class="ft-list mr-2"></i>Recent Transactions
                      </h5>
                      <button
                        class="btn btn-outline-primary btn-sm"
                        routerLink="/reports/daybook"
                      >
                        View All
                      </button>
                    </div>
                  </div>
                  <div class="card-body p-0">
                    <div class="table-responsive">
                      <table class="table table-hover mb-0">
                        <thead class="bg-light">
                          <tr>
                            <th class="border-0">ID</th>
                            <th class="border-0">Date</th>
                            <th class="border-0">Description</th>
                            <th class="border-0">Account</th>
                            <th class="border-0 text-right">Amount</th>
                            <th class="border-0">Type</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let transaction of recentTransactions" class="transaction-row">
                            <td class="font-weight-medium">
                              {{ transaction.id }}
                            </td>
                            <td>{{ transaction.date | date: 'MMM dd, yyyy' }}</td>
                            <td>
                              <div class="text-truncate" style="max-width: 200px;" [title]="transaction.description">
                                {{ transaction.description }}
                              </div>
                            </td>
                            <td class="text-muted">
                              <div class="text-truncate" style="max-width: 150px;" [title]="transaction.account">
                                {{ transaction.account }}
                              </div>
                            </td>
                            <td
                              class="text-right font-weight-bold"
                              [ngClass]="getTransactionClass(transaction.type)"
                            >
                              {{ formatCurrency(abs(transaction.amount)) }}
                            </td>
                            <td>
                              <span
                                class="badge badge-pill"
                                [ngClass]="
                                  transaction.type === 'credit'
                                    ? 'badge-success'
                                    : 'badge-danger'
                                "
                              >
                                {{ transaction.type | titlecase }}
                              </span>
                            </td>
                          </tr>
                          
                          <!-- No Data Row -->
                          <tr *ngIf="!isLoading && recentTransactions.length === 0">
                            <td colspan="6" class="text-center text-muted py-4">
                              <i class="ft-file-text mb-2" style="font-size: 2rem;"></i>
                              <div>No recent transactions found</div>
                              <small>Transaction data will appear here when available</small>
                            </td>
                          </tr>
                          
                          <!-- Loading Rows -->
                          <tr *ngIf="isLoading" class="loading-row">
                            <td colspan="6" class="text-center py-4">
                              <div class="spinner-border spinner-border-sm text-primary" role="status">
                                <span class="sr-only">Loading transactions...</span>
                              </div>
                              <span class="ml-2 text-muted">Loading recent transactions...</span>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Navigation Cards for Main Modules -->
            <div class="row">
              <div class="col-12">
                <div class="card border-0 shadow-sm">
                  <div class="card-header bg-white border-bottom-0">
                    <h5 class="card-title mb-0">
                      <i class="ft-grid mr-2"></i>Main Modules
                    </h5>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div
                        class="col-lg-4 col-md-6 col-12 mb-3"
                        *ngFor="let item of MenuItems"
                      >
                        <div class="card border border-light">
                          <div class="card-body text-center p-3">
                            <i
                              class="{{ item.icon }} text-primary mb-2"
                              style="font-size: 2rem"
                            ></i>
                            <h6 class="card-title">{{ item.title }}</h6>
                            <a
                              [routerLink]="item.path"
                              class="btn btn-outline-primary btn-sm"
                            >
                              Access Module
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!--Login Page Ends-->
