<form (ngSubmit)="SaveData()" #fromPurchase="ngForm">
  <div class="row no-pad">
    <div class="col-md-2">
      <label for="dp1">Date:</label>
      <div class="input-group">
        <input
          class="form-control"
          placeholder="yyyy-mm-dd"
          name="dp1"
          [(ngModel)]="purchase.Date"
          ngbDatepicker
          #d1="ngbDatepicker"
        />

        <div class="input-group-append">
          <button type="button" class="btn btn-warning" (click)="d1.toggle()">
            <i class="fa fa-calendar"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="col-md-2">
      <label for="dp2">Invoice Date:</label>
      <div class="input-group">
        <input
          class="form-control"
          placeholder="yyyy-mm-dd"
          name="dp2"
          [(ngModel)]="purchase.InvoiceDate"
          ngbDatepicker
          #d2="ngbDatepicker"
        />

        <div class="input-group-append">
          <button type="button" class="btn btn-warning" (click)="d2.toggle()">
            <i class="fa fa-calendar"></i>
          </button>
        </div>
      </div>
    </div>


    <div class="form-group col-md-2">
      <label for="customer">Invoice No</label>
      <input class="form-control" type="text" name="inv_no"  [(ngModel)]="purchase.InvoiceNo">
    </div>
    <div class="form-group col-md-2">
      <label for="customer">Acct Type</label>
      <ejs-combobox
        name="accttype"
        id="accttype"
        #acctType
        [dataSource]="AcctTypes | async"
        [fields]="{ text: 'AcctType', value: 'AcctTypeID' }"
        (change)="getAccounts($event.value)"
      >
      </ejs-combobox>
    </div>
    <div class="form-group col-md-4">
      <label for="customer">Customer <span class="text-right"> </span></label>

      <ejs-combobox
        name="customer"
        id="customer"
        [dataSource]="Accounts"
        [fields]="{ text: 'CustomerName', value: 'CustomerID' }"
        [allowFiltering]="true"
        (filtering)="onFiltering($event, 'CustomerName')"
        [(ngModel)]="purchase.CustomerID"
        required
        (change)="CustomerSelected($event)"
      >
      </ejs-combobox>
    </div>
    <div class="col-md-2 form-group">
      <label for="">Adress</label>
      <p>
        <Strong> {{ SelectCust.Address }}, {{ SelectCust.City }}</Strong>
      </p>
    </div>
    <div class="col-md-2 form-group">
      <label for="">Balance</label>
      <p>
        <Strong> {{ SelectCust.Balance }} </Strong>
      </p>
    </div>
  </div>
  <form #formqty="ngForm">
    <div class="row no-gutter">
      <div class="col-md-2">
        <div class="form-group">
          <label for="cmbCompany">Company:</label>
          <ejs-combobox
            name="cmbCompany"
            id="cmbCompany"
            #cmbCompany
            [(ngModel)]="pdetails.CompanyID"
            [dataSource]="Companies$ | async"
            [fields]="{ text: 'CompanyName', value: 'CompanyID' }"
            placeholder="Select Company..."
            (change)="getProducts($event.itemData)"
          >
          </ejs-combobox>
        </div>
      </div>
      <div class="col-md-3">
        <div class="form-group">
          <label for="supplier">Select Product:</label>
          <ejs-combobox
            name="prods"
            id="prods"
            #cmbProd
            [dataSource]="Prods"
            [fields]="{ text: 'ProductName', value: 'ProductID' }"
            placeholder="Select Item..."
            required="required"
            [(ngModel)]="pdetails.ProductID"
            (change)="ProductSelected($event)"
          >
          <ng-template #footerTemplate="" let-data="">
            <!--set the value to footerTemplate property-->
            <div class="row">
              <div class="col text-center">
                <a class="btn btn-sm btn-primary" [routerLink]="" (click)="AddNewProduct()">Add New Product</a>

              </div>
            </div>

        </ng-template>
          </ejs-combobox>
        </div>
      </div>
      <div class="col-md-5">
        <div class="row no-gutter">
          <div class="col">
            <div class="form-group">
              <label for="BatchNo">Batch No:</label>
              <input
                type="text"
                class="form-control"
                id="BatchNo"
                name="BatchNo"
                required
                [(ngModel)]="pdetails.BatchNo"
              />
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <label for="Pcs">Qty (Pcs):</label>
              <input
                type="number"
                class="form-control dation-field"
                required="required"
                id="Pcs"
                name="Pcs"
                [(ngModel)]="pdetails.Pcs"
                placeholder="0"
              />
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <label for="bonus">Bonus:</label>
              <input
                type="number"
                class="form-control"
                id="bonus"
                name="bonus"
                [(ngModel)]="pdetails.Bonus"
                placeholder="0"
              />
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <label for="supplier">Trade Price:</label>
              <input
                type="number"
                class="form-control"
                id="SPrice"
                name="SPrice"
                [(ngModel)]="pdetails.SPrice"
                placeholder="0"
              />
            </div>
          </div>


        </div>
        <div class="row no-gutter">
          <div class="col">
            <div class="form-group">
              <label for="supplier">Retail Price:</label>
              <input
                type="number"
                class="form-control"
                id="RPrice"
                name="RPrice"
                [(ngModel)]="pdetails.RPrice"
                placeholder="0"
              />
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <label for="supplier">P. Price:</label>
              <input
                type="number"
                class="form-control"
                id="pprice"
                name="pprice"
                [(ngModel)]="pdetails.PPrice"
                placeholder="0"
              />
            </div>
          </div>

          <div class="col">
            <div class="form-group">
              <label for="DiscRatio">Disc %:</label>
              <input
                type="number"
                class="form-control"
                id="DiscRatio"
                name="DiscRatio"
                [(ngModel)]="pdetails.DiscRatio"
              />
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <label for="ExpiryDate">Expiry Date:</label>
              <input
                type="date"
                class="form-control"
                id="ExpiryDate"
                name="ExpiryDate"
                [(ngModel)]="pdetails.ExpiryDate"
              />
            </div>
          </div>

        </div>
      </div>

      <div class="col-md-2">
        <div class="row">
          <div class="col-md-12">
            <div class="form-group">
              <label for="bonus">Amount:</label>
              <input
                type="number"
                class="form-control"
                id="pamount"
                name="pamount"
                readonly
                [value]="
                  RoundIt((pdetails.Qty * pdetails.Packing + pdetails.Pcs) *
                  pdetails.PPrice -
                ((pdetails.Qty * pdetails.Packing + pdetails.Pcs) *
                  pdetails.PPrice *
                  pdetails.DiscRatio) /
                  100)
                "
              />
            </div>
          </div>
          <div class="col-md-12">
            <div class="form-group">
              <label for="DiscRatio">&nbsp;</label>
              <button
                type="submit"
                class="btn btn-primary form-control"
                [disabled]="!formqty.form.valid"
                (click)="AddOrder()"
                accesskey="a"
              >
                Add
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>
  <div style="margin: 5px; padding-bottom: 4px">
    <div
      class="table-responsive custom-table-height table-bordered table-condensed pb-1"
    >
      <ng2-smart-table
        class="table table-hover"
        [settings]="settings"
        [source]="data"
        (deleteConfirm)="onDeleteConfirm($event)"
        (rowSelect)="onRowSelect($event)"
        (userRowSelect)="onUserRowSelect($event)"
        (editConfirm)="onEdit($event)"
        (rowHover)="onRowHover($event)"
      >
      </ng2-smart-table>
    </div>
    <div class="row no-gutter">
      <div class="col-md-8">
        <div class="row no-gutter">
          <div class="col-md-12">
            <div class="form-group">
              <label for="notes">Notes:</label>

              <input
                type="text"
                class="form-control"
                id="notes"
                name="notes"
                [(ngModel)]="purchase.Notes"
                placeholder="x"
              />
            </div>
          </div>
        </div>
        <div class="row no-gutter">
          <div class="col-md-6">
            <div class="form-group">
              <label for="dp2">&nbsp;</label>
              <button
                type="button"
                class="btn btn-primary form-control"
                [disabled]="!fromPurchase.form.valid || data.count() == 0"
                (click)="SaveData()"
                accesskey="s"
              >
                Save
              </button>
            </div>
          </div>

          <div class="col-md-6">
            <div class="form-group">
              <label for="dp2">&nbsp;</label>
              <button
                type="button"
                class="btn btn-danger form-control"
                (click)="Cancel()"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="row no-gutter">
          <div class="col-md-6">
            <label for="gtotal" style="padding-top: 5px">Total Amount:</label>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <input
                type="text"
                class="form-control"
                id="gtotal"
                name="gtotal"
                [(ngModel)]="purchase.Amount"
                readonly
              />
            </div>
          </div>
        </div>

        <div class="row no-gutter">
          <div class="col-md-6">
            <label for="rdisc" style="padding-top: 5px">Discount:</label>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <input
                type="text"
                class="form-control"
                id="rdisc"
                name="rdisc"
                [(ngModel)]="purchase.Discount"
                (change)="changel()"
                readonly
              />
            </div>
          </div>
        </div>
        <div class="row no-gutter">
          <div class="col-md-6">
            <label for="rdisc" style="padding-top: 5px">Extra Disc:</label>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <input
                type="text"
                class="form-control"
                id="rdisc"
                name="rdisc"
                [(ngModel)]="purchase.ExDiscount"
              />
            </div>
          </div>
        </div>

        <div class="row no-gutter">
          <div class="col-md-6">
            <label for="amount" style="padding-top: 5px">Net Amount:</label>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <input
                type="text"
                class="form-control"
                id="amount"
                name="amount"
                [value]="purchase.NetAmount - purchase.ExDiscount"
                readonly
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>
